# EXPERIMENT
device: 'cuda'
dirpath: '.'
exp_name: 'scalr_test'
exp_run: 0

# DATA_CONFIG
data:
    sample_chunksize: 10000

    data_splits:
        full_datapath: '/home/biocusp/data/scp_ad/full.h5ad'
        split_data:
            split_ratio: [7, 1, 2.5]
            stratify: 'donor_id'

        # train_datapath: '/path/to/train_data'
        # val_datapath: '/path/to/val_data'
        # test_datapath: '/path/to/test_data'

    preprocess:
        - name: SampleNorm
          params:
                **args

        - name: StandardNorm
          params: 
                **args
            

    target: Cell_Type    

# FEATURE_SELECTION_CONFIG
feature_selection:

    # weight_matrix: '/path/to/matrix'
    scoring_method: 
        name: feature_chunk
        feature_chunksize: 3000

        model:
            name: 'linear'

        model_train_config:
            epochs: 1
            batch_size: 15000
            lr: 1.0e-3
            weight_decay: 0.1

    top_features:
        k: 5000
        aggregation_strategy: mix

# TRAINING
training:

    model:
        name: 'linear'
        params:
            layers: [3000, 6]
            dropout: 0
            weights_init_zero: False

    start_checkpoint: null
    resume_from_checkpoint: False

    opt: 'Adam'
    loss: 'CrossEntropyLoss'
    batch_size: 15000
    lr: 1.0e-3
    weight_decay: 0
    epochs: 1

    callbacks:
        - name: TensorboardLogging
        - name: EarlyStopping
          params:
            patience: 3
            min_delta: 1.0e-4
        - name: ModelCheckpointing
          params:
            interval: 5

# ANALYSIS
analysis:
    model_checkpoint: '/path/to/model'
    batch_size: 15000
    
    analysis_methods:
        - name: deg
          params: **args

        - name: gene_recall
          params: **args
    # gene_recall:
    #     ## `feature_class_weights_path` & `ranked_genes` are mutually exclusive. Or if you comment out both,
    #     ## then pipeline generated feature_class_weights matrix is used.
    #     # feature_class_weights_path: '/path/to/feature_class_weights matrix csv'
    #     # ranked_genes:
    #     #     per_category: '/path/to/ranked_genes_per_category'
    #     #     aggregated: '/path/to/ranked_genes_aggr_all_categories csv'
    #     reference_genes:
    #         per_category: '/path/to/ref_genes_per_category csv'
    #         aggregated: '/path/to/ref_genes_aggr_all_categories csv'
    #     top_K: 5000
    #     plots_per_row: 5   